# Template file for 'mediainfo'
pkgname=mediainfo
version=20.03
revision=2
wrksrc=MediaInfo
configure_args="--with-wx-config=wx-config-gtk3"
hostmakedepends="automake libtool pkg-config"
makedepends="libmediainfo-devel zlib-devel wxWidgets-gtk3-devel"
short_desc="Display technical and tag data for video and audio files"
maintainer="John <johnz@posteo.net>"
license="BSD-2-Clause"
homepage="https://mediaarea.net/MediaInfo"
distfiles="https://mediaarea.net/download/source/${pkgname}/${version}/${pkgname}_${version}.tar.xz"
checksum=dc3ef8a2aea8d1bb101c679209de941d094141113acda42677c101c7bc853ab8

do_configure() {
	local targets="CLI GUI"

	for d in $targets; do
		cd $wrksrc/Project/GNU/$d
		autoreconf -fi
		./configure ${configure_args}
	done
}

do_build() {
	local targets="CLI GUI"

	for d in $targets; do
		cd $wrksrc/Project/GNU/$d
		make ${makejobs}
	done
}

do_install() {
	local targets="CLI GUI"

	for d in $targets; do
		cd $wrksrc/Project/GNU/$d
		make DESTDIR="${DESTDIR}" install
	done
	vlicense ${wrksrc}/License.html

	vinstall ${wrksrc}/Source/Resource/Image/MediaInfo.svg 644 \
		usr/share/icons/hicolor/scalable/apps mediainfo.svg
	vinstall ${wrksrc}/Source/Resource/Image/MediaInfo.png 644 \
		usr/share/pixmaps mediainfo-gui.png
	vinstall ${wrksrc}/Project/GNU/GUI/mediainfo-gui.desktop 644 \
		usr/share/applications
}

mediainfo-gui_package() {
	short_desc+=" - gtk user interface"
	# GUI does not depend on CLI
	depends="desktop-file-utils hicolor-icon-theme"

	pkg_install() {
		vmove /usr/bin/mediainfo-gui
		vmove /usr/share
	}
}
